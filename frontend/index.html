<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmartXCrop - Farmer's Marketplace</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body>

    <!-- Authentication Screen -->
    <div id="authScreen" class="auth-screen">
        <div class="auth-container">
            <div class="auth-header">
                <h1>üå± SmartXCrop</h1>
                <p>Connect, Trade, and Grow Together</p>
            </div>

            <!-- Login Form -->
            <div id="loginForm">
                <form onsubmit="event.preventDefault(); login();">
                    <div class="form-group">
                        <label for="username">Username</label>
                        <input type="text" id="username" class="form-control" placeholder="Enter your username" required>
                    </div>
                    <div class="form-group">
                        <label for="password">Password</label>
                        <input type="password" id="password" class="form-control" placeholder="Enter your password" required>
                    </div>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-sign-in-alt"></i> Login
                    </button>
                </form>
                <p style="text-align: center; margin-top: 20px;">
                    Don't have an account? 
                    <a href="#" onclick="showSignup()" style="color: var(--primary-green);">Sign up here</a>
                </p>
            </div>

            <!-- Signup Form -->
            <div id="signupForm" class="hidden">
                <form onsubmit="event.preventDefault(); signup();">
                    <div class="form-group">
                        <label for="fullName">Full Name</label>
                        <input type="text" id="fullName" class="form-control" placeholder="Enter your full name" required>
                    </div>
                    <div class="form-group">
                        <label for="age">Age</label>
                        <input type="number" id="age" class="form-control" placeholder="Enter your age" min="18" max="100" required>
                    </div>
                    <div class="form-group">
                        <label for="region">Region</label>
                        <input type="text" id="region" class="form-control" placeholder="Enter your region" required>
                    </div>
                    <div class="form-group">
                        <label>User Type</label>
                        <div class="user-type-selector">
                            <div class="user-type-option" onclick="selectUserType(this, 'farmer')">
                                <i class="fas fa-tractor"></i>
                                <div>Farmer</div>
                            </div>
                            <div class="user-type-option" onclick="selectUserType(this, 'buyer')">
                                <i class="fas fa-shopping-cart"></i>
                                <div>Buyer</div>
                            </div>
                            <div class="user-type-option" onclick="selectUserType(this, 'both')">
                                <i class="fas fa-exchange-alt"></i>
                                <div>Both</div>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="signupUsername">Username</label>
                        <input type="text" id="signupUsername" class="form-control" placeholder="Choose a username" required>
                    </div>
                    <div class="form-group">
                        <label for="signupPassword">Password</label>
                        <input type="password" id="signupPassword" class="form-control" placeholder="Create a password" required>
                    </div>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-user-plus"></i> Create Account
                    </button>
                </form>
                <p style="text-align: center; margin-top: 20px;">
                    Already have an account? 
                    <a href="#" onclick="showLogin()" style="color: var(--primary-green);">Login here</a>
                </p>
            </div>
        </div>
    </div>

    <!-- Main App Screen -->
    <div id="appScreen" class="app-screen hidden">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="logo">
                    <h1>üå± SmartXCrop</h1>
                </div>
                <div class="header-actions">
                    <!-- NEW: Notification Bell -->
                    <div class="notification-bell" onclick="toggleNotificationWindow()">
                        <i class="fas fa-bell"></i>
                        <div class="notification-bell-badge" id="notificationBadge" style="display: none;">0</div>
                    </div>
                    
                    <div class="cart-icon" onclick="showCart()">
                        <i class="fas fa-shopping-cart"></i>
                        <div class="cart-badge" style="display: none;">0</div>
                    </div>
                    <div class="profile-mini" onclick="switchTab('profile')">
                        <div id="mainProfileAvatar" class="user-avatar"></div>
                    </div>
                    <button class="btn btn-secondary btn-small" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                </div>
            </div>
        </header>

        <!-- NEW: Notification Window -->
        <div id="notificationWindow" class="notification-window hidden">
            <div class="notification-window-header">
                <h3>üîî Notifications</h3>
                <button class="btn btn-small" onclick="toggleNotificationWindow()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="notification-list" id="notificationList">
                <!-- Notifications will be dynamically added here -->
            </div>
            <div class="notification-window-footer">
                <button class="btn btn-small" onclick="clearAllNotifications()">
                    <i class="fas fa-trash"></i> Clear All
                </button>
            </div>
        </div>

        <!-- Navigation Tabs -->
        <nav class="nav-tabs">
            <div class="tab-buttons">
                <button class="tab-button active" onclick="switchTab('feed')">
                    <i class="fas fa-home"></i> Feed
                </button>
                <button class="tab-button" onclick="switchTab('map')">
                    <i class="fas fa-map-marked-alt"></i> Map
                </button>
                <button class="tab-button" onclick="switchTab('agroInputs')">
                    <i class="fas fa-seedling"></i> Agro Inputs
                </button>
                <button class="tab-button" onclick="switchTab('priceMonitoring')">
                    <i class="fas fa-chart-line"></i> Price Monitoring
                </button>
                <button class="tab-button" onclick="switchTab('messages')">
                    <i class="fas fa-comments"></i> Messages
                </button>
                <button class="tab-button" onclick="switchTab('profile')">
                    <i class="fas fa-user"></i> Profile
                </button>
                <button class="tab-button" onclick="openMyFarm()">
                    <i class="fas fa-tractor"></i> My Farm
                </button>
                <button class="tab-button" onclick="openPlantIdentification()">
                    <i class="fas fa-camera"></i> Plant ID
                </button>
                <button class="tab-button" onclick="openDiseaseDetection()">
                    <i class="fas fa-heartbeat"></i> Crop Health
                </button>
            </div>
        </nav>

        <!-- Tab Contents -->
        <main class="tab-content-container">
            <!-- Feed Tab -->
            <div id="feedTab" class="tab-content">
                <div class="feed">
                    <!-- Products will be dynamically loaded here -->
                </div>
            </div>

            <!-- Map Tab -->
            <div id="mapTab" class="tab-content hidden">
                <div class="map-container">
                    <div id="realMap"></div>
                </div>
            </div>

            <!-- Agro Inputs Tab -->
            <div id="agroInputsTab" class="tab-content hidden">
                <!-- Agro inputs will be dynamically loaded here -->
            </div>

            <!-- Price Monitoring Tab -->
            <div id="priceMonitoringTab" class="tab-content hidden">
                <div class="price-monitoring-container">
                    <div class="section-header">
                        <h3>üìä Price Monitoring</h3>
                        <p>Real-time market price trends for agricultural products</p>
                    </div>
                    
                    <div class="price-controls">
                        <select id="productCategoryFilter" onchange="updatePriceChart()">
                            <option value="all">All Categories</option>
                            <option value="vegetables">Vegetables</option>
                            <option value="fruits">Fruits</option>
                            <option value="grains">Grains</option>
                            <option value="herbs">Herbs</option>
                        </select>
                        <select id="timeRangeFilter" onchange="updatePriceChart()">
                            <option value="24h">Last 24 Hours</option>
                            <option value="7d">Last 7 Days</option>
                            <option value="30d">Last 30 Days</option>
                        </select>
                        <select id="regionFilter" onchange="updatePriceChart()">
                            <option value="all">All Regions</option>
                            <option value="metro-manila">Metro Manila</option>
                            <option value="central-luzon">Central Luzon</option>
                            <option value="calabarzon">CALABARZON</option>
                            <option value="bicol">Bicol Region</option>
                            <option value="visayas">Visayas</option>
                            <option value="mindanao">Mindanao</option>
                        </select>
                    </div>

                    <div class="chart-container">
                        <canvas id="priceChart"></canvas>
                    </div>

                    <div class="price-stats">
                        <div class="stat-item">
                            <span class="stat-number" id="currentAvgPrice">‚Ç±0.00</span>
                            <span class="stat-label">Current Average</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number" id="priceChange">0%</span>
                            <span class="stat-label">24h Change</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number" id="highestPrice">‚Ç±0.00</span>
                            <span class="stat-label">Highest Price</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number" id="lowestPrice">‚Ç±0.00</span>
                            <span class="stat-label">Lowest Price</span>
                        </div>
                    </div>

                    <div class="price-alerts">
                        <h4>üîî Price Alerts</h4>
                        <div class="alert-settings">
                            <div class="form-group">
                                <label for="alertProduct">Product</label>
                                <select id="alertProduct" class="form-control">
                                    <option value="tomato">Tomato</option>
                                    <option value="rice">Rice</option>
                                    <option value="corn">Corn</option>
                                    <option value="eggplant">Eggplant</option>
                                    <option value="lettuce">Lettuce</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="alertPrice">Alert When Price Below (‚Ç±)</label>
                                <input type="number" id="alertPrice" class="form-control" placeholder="Enter price" step="0.01">
                            </div>
                            <button class="btn btn-primary" onclick="setPriceAlert()">
                                <i class="fas fa-bell"></i> Set Alert
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Messages Tab -->
            <div id="messagesTab" class="tab-content hidden">
                <!-- Messages will be dynamically loaded here -->
            </div>

            <!-- Profile Tab -->
            <div id="profileTab" class="tab-content hidden">
                <div class="profile-section">
                    <div class="profile-header">
                        <div id="profileAvatarLarge" class="profile-avatar-large"></div>
                        <div class="profile-info">
                            <h2 id="profileName">Loading...</h2>
                            <p id="profileDetails">Loading...</p>
                            <p><strong>User Type:</strong> <span id="profileType">Loading...</span></p>
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="openEditProfile()">
                        <i class="fas fa-edit"></i> Edit Profile
                    </button>
                </div>

                <div class="profile-section">
                    <div class="section-header">
                        <h3>üìä My Stats</h3>
                    </div>
                    <div class="profile-stats">
                        <div class="stat-item">
                            <span class="stat-number" id="productsCount">0</span>
                            <span class="stat-label">Products</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number" id="salesCount">0</span>
                            <span class="stat-label">Sales</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number" id="ratingScore">0</span>
                            <span class="stat-label">Rating</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number" id="reviewsCount">0</span>
                            <span class="stat-label">Reviews</span>
                        </div>
                    </div>
                </div>

                <div class="profile-section">
                    <div class="section-header">
                        <h3>üõçÔ∏è My Products</h3>
                        <button class="btn btn-primary btn-small" onclick="showAddProductForm()">
                            <i class="fas fa-plus"></i> Add Product
                        </button>
                    </div>
                    <div class="my-products-grid">
                        <!-- Products will be dynamically loaded here -->
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="script.js"></script>
</body>
</html>